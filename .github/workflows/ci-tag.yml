name: Build Store Zip (Tag)

on:
    push:
        tags:
            - 'v*'

jobs:
    build_store_zip:
        runs-on: ubuntu-latest
        permissions:
            contents: write
        steps:
            - uses: actions/checkout@v4
            - name: Compute zip name
              run: |
                  echo "ZIP_NAME=json-formatter-release-${GITHUB_REF_NAME}.zip" >> "$GITHUB_ENV"
            - name: Create release folder
              run: |
                  rm -rf release
                  mkdir -p release
                  cp manifest.json background.js content.js formatter.html formatter.js formatter.css favicon.svg favicon-16.png favicon-32.png favicon-48.png favicon-128.png release/
            - name: Zip release
              run: |
                  cd release
                  zip -r "../${ZIP_NAME}" .
            - name: Upload zip artifact
              uses: actions/upload-artifact@v4
              with:
                  name: json-formatter-release
                  path: ${{ env.ZIP_NAME }}
            - name: Publish GitHub Release
              uses: softprops/action-gh-release@v2
              with:
                  files: ${{ env.ZIP_NAME }}
