name: Build Store Zip

on:
    push:
        branches:
            - master

jobs:
    build_store_zip:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - name: Create release folder
              run: |
                  rm -rf release
                  mkdir -p release
                  cp manifest.json background.js content.js formatter.html formatter.js formatter.css favicon.svg favicon-16.png favicon-32.png favicon-48.png favicon-128.png release/
            - name: Zip release
              run: |
                  cd release
                  version=$(python3 - <<'PY'
                  import json
                  with open('../manifest.json', 'r', encoding='utf-8') as f:
                      data = json.load(f)
                  print(data.get('version', '0.0.0'))
                  PY
                  )
                  zip -r ../json-formatter-release-v${version}.zip .
            - name: Upload zip artifact
              uses: actions/upload-artifact@v4
              with:
                  name: json-formatter-release
                  path: json-formatter-release-v*.zip
