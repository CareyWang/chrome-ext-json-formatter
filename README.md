# JSON Formatter Chrome 扩展

一个 Chrome 浏览器扩展，旨在自动格式化和美化直接在浏览器中打开的 JSON 数据，使其更易于阅读和理解。

## 功能

- **自动 JSON 检测**:
  - 检测浏览器直接打开的原始 JSON 页面（常见为单个 `<pre>`，或 `Content-Type` 为 JSON）。
  - 仅在明确是 JSON 页面时才解析并格式化，避免对普通 HTML 页面误判。
- **代码美化与语法高亮**:
  - 将 JSON 数据解析后按两空格缩进展示。
  - 内置轻量 token 样式（不依赖第三方脚本），降低 CSP/注入风险。
- **JSON 层级折叠**:
  - 支持按层级折叠和展开 JSON 对象和数组。
  - 提供快捷按钮：展开全部、折叠全部、按层级折叠（1-3级）。
  - 折叠时显示简化信息（如对象属性数量、数组项目数量）。
  - 点击折叠按钮可切换展开/折叠状态。
- **行号显示**: 在格式化后的 JSON旁边显示行号，方便定位和引用。
- **一键复制**: 提供“复制JSON”按钮（拷贝为两空格缩进的格式化文本）。
- **自定义样式**: 应用简洁的样式以优化 JSON 数据的展示。
- **避免重复处理**: 包含防止对同一内容进行多次格式化的机制。
- **广泛适用性**: 设计用于在所有网站上工作。

## 如何工作

1. **内容脚本 (`content.js`)**:
    - 在页面加载完成后运行，优先判断是否为“浏览器直接打开的 raw JSON 页面”。
    - 解析成功后，使用 Shadow DOM 渲染格式化视图（更 CSP 友好、避免内联脚本）。
    - 提供折叠/行号/复制等交互（全部通过事件监听实现，不使用 `onclick` 字符串注入）。

## 安装

1. 下载此项目的代码库或将其克隆到本地计算机。
2. 打开 Chrome 浏览器，导航到 `chrome://extensions`。
3. 确保右上角的 "开发者模式 (Developer mode)" 开关已启用。
4. 点击 "加载已解压的扩展程序 (Load unpacked)" 按钮。
5. 在文件选择对话框中，选择包含此项目文件（例如 `manifest.json` 所在的目录）的文件夹。
6. 扩展程序 "JSON Formatter" 现在应该已安装并处于活动状态。

## 使用方法

安装扩展程序后，它会自动在您浏览到包含原始 JSON 数据的页面时生效。无需任何手动操作，JSON 内容将被自动格式化和高亮显示。

> 说明：为避免极大 JSON 导致卡顿，过大的 JSON 会提示并跳过格式化。

### 折叠功能使用

1. **自动折叠按钮**: 页面右上角提供了控制按钮
   - **展开全部**: 展开所有折叠的 JSON 层级
   - **折叠全部**: 折叠所有 JSON 对象和数组
   - **折叠1级/2级/3级**: 按指定层级深度折叠 JSON 结构

2. **手动折叠**: 点击每个对象或数组前的 `-` 按钮可以折叠该层级，点击 `+` 按钮可以展开

3. **折叠状态显示**: 
   - 折叠的对象会显示 `... X 属性`
   - 折叠的数组会显示 `... X 项`

这些功能特别适用于查看大型 JSON 文件，可以帮助您快速定位和理解 JSON 结构。

## 手工验证

1. 打开 `chrome://extensions`，开启开发者模式，加载本目录为“已解压的扩展程序”。
2. 启动本地服务：`python3 -m http.server 8000`，打开 `http://localhost:8000/test.json`。
3. 检查：格式化/折叠按钮/行号/“复制JSON”是否正常；再测试一个无效 JSON，确认不会误格式化普通页面。
